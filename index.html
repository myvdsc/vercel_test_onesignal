<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>OneSignal Web Push v16 Test</title>

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- OneSignal SDK v16 -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      try {
        await OneSignal.init({
          appId: "53c86d63-20f1-4b62-803a-52183b5efcc9", // ğŸ” Thay báº±ng App ID tá»« OneSignal Dashboard
          serviceWorkerPath: "OneSignalSDKWorker.js",
          serviceWorkerUpdaterPath: "OneSignalSDKUpdaterWorker.js",
          autoResubscribe: true,
          promptOptions: {
            slidedown: {
              enabled: true,
              actionMessage: "Báº¡n muá»‘n nháº­n thÃ´ng bÃ¡o tá»« trang web?",
              acceptButtonText: "Cho phÃ©p",
              cancelButtonText: "Tá»« chá»‘i"
            }
          }
        });

        console.log("âœ… OneSignal initialized");

        const permission = await OneSignal.Notifications.permissionNative();
        console.log("Quyá»n hiá»‡n táº¡i:", permission);

        const isSubscribed = await OneSignal.Notifications.isPushEnabled();
        console.log("Push Ä‘ang báº­t:", isSubscribed);

      } catch (e) {
        console.error("âŒ Lá»—i khá»Ÿi táº¡o OneSignal:", e);
      }
    });
  </script>
</head>
<body>
  <h2>Test OneSignal Web Push (SDK v16)</h2>
  <button id="subscribeBtn">ÄÄƒng kÃ½ nháº­n thÃ´ng bÃ¡o</button>
  <pre id="log"></pre>

  <script>
    const log = msg => {
      document.getElementById("log").textContent += msg + "\n";
      console.log(msg);
    };

    document.getElementById("subscribeBtn").addEventListener("click", async () => {
      try {
        const OneSignal = window.OneSignal;
        const isPushEnabled = await OneSignal.Notifications.isPushEnabled();

        if (!isPushEnabled) {
          await OneSignal.Notifications.requestPermission();
          log("âœ… ÄÃ£ yÃªu cáº§u báº­t thÃ´ng bÃ¡o.");
        } else {
          log("ğŸ”” Báº¡n Ä‘Ã£ Ä‘Äƒng kÃ½ nháº­n thÃ´ng bÃ¡o rá»“i.");
        }

      } catch (err) {
        log("âŒ Lá»—i Ä‘Äƒng kÃ½ nháº­n thÃ´ng bÃ¡o: " + err.message);
      }
    });
  </script>
</body>
</html>
