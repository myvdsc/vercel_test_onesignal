<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>OneSignal Web Push v16 Test</title>

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- OneSignal SDK v16 -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      try {
        await OneSignal.init({
          appId: "53c86d63-20f1-4b62-803a-52183b5efcc9", // 🔁 Thay bằng App ID từ OneSignal Dashboard
          serviceWorkerPath: "OneSignalSDKWorker.js",
          serviceWorkerUpdaterPath: "OneSignalSDKUpdaterWorker.js",
          autoResubscribe: true,
          promptOptions: {
            slidedown: {
              enabled: true,
              actionMessage: "Bạn muốn nhận thông báo từ trang web?",
              acceptButtonText: "Cho phép",
              cancelButtonText: "Từ chối"
            }
          }
        });

        console.log("✅ OneSignal initialized");

        const permission = await OneSignal.Notifications.permissionNative();
        console.log("Quyền hiện tại:", permission);

        const isSubscribed = await OneSignal.Notifications.isPushEnabled();
        console.log("Push đang bật:", isSubscribed);

      } catch (e) {
        console.error("❌ Lỗi khởi tạo OneSignal:", e);
      }
    });
  </script>
</head>
<body>
  <h2>Test OneSignal Web Push (SDK v16)</h2>
  <button id="subscribeBtn">Đăng ký nhận thông báo</button>
  <pre id="log"></pre>

  <script>
    const log = msg => {
      document.getElementById("log").textContent += msg + "\n";
      console.log(msg);
    };

    document.getElementById("subscribeBtn").addEventListener("click", async () => {
      try {
        const OneSignal = window.OneSignal;
        const isPushEnabled = await OneSignal.Notifications.isPushEnabled();

        if (!isPushEnabled) {
          await OneSignal.Notifications.requestPermission();
          log("✅ Đã yêu cầu bật thông báo.");
        } else {
          log("🔔 Bạn đã đăng ký nhận thông báo rồi.");
        }

      } catch (err) {
        log("❌ Lỗi đăng ký nhận thông báo: " + err.message);
      }
    });
  </script>
</body>
</html>
