<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>OneSignal Web Push v16 Test</title>

  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function (OneSignal) {
      try {
        await OneSignal.init({
          appId: "53c86d63-20f1-4b62-803a-52183b5efcc9", // 🔁 Thay bằng App ID thật
          serviceWorkerPath: "OneSignalSDKWorker.js",
          serviceWorkerUpdaterPath: "OneSignalSDKUpdaterWorker.js",
          autoResubscribe: true,
          promptOptions: {
            slidedown: {
              enabled: true,
              actionMessage: "Bạn có muốn nhận thông báo?",
              acceptButtonText: "Có",
              cancelButtonText: "Không"
            }
          }
        });

        console.log("✅ OneSignal initialized");

        // Kiểm tra xem đã có đăng ký chưa
        const sub = await OneSignal.User.PushSubscription.getSubscription();
        if (sub && sub.id) {
          console.log("🔔 Đã đăng ký với Player ID:", sub.id);
        } else {
          console.log("❌ Chưa đăng ký nhận thông báo");
        }

        // Gắn sự kiện cho nút đăng ký
        document.getElementById("subscribeBtn").addEventListener("click", async () => {
          try {
            await OneSignal.User.PushSubscription.optIn();
            const sub = await OneSignal.User.PushSubscription.getSubscription();
            if (sub && sub.id) {
              console.log("✅ Đăng ký thành công với Player ID:", sub.id);
              document.getElementById("log").textContent = "Player ID: " + sub.id;
            } else {
              console.log("❌ Đăng ký không thành công.");
            }
          } catch (e) {
            console.error("❌ Lỗi đăng ký nhận thông báo:", e);
          }
        });

      } catch (e) {
        console.error("❌ Lỗi khởi tạo OneSignal:", e);
      }
    });
  </script>
</head>
<body>
  <h2>Test OneSignal Web Push (SDK v16)</h2>
  <button id="subscribeBtn">Đăng ký nhận thông báo</button>
  <pre id="log"></pre>
</body>
</html>
